name: CI - E2E Allure (Smoke)

on:
  workflow_dispatch: {}
  pull_request: {}
  push:
    branches: ["main", "auto-build-maintenance"]

jobs:
  e2e:
    name: E2E (Smoke)
    uses: ./.github/workflows/shared-allure-core.yml
    secrets: inherit
    with:
      cucumber_profile: "allure_pretty"
      cucumber_tags: "@smoke"
      retention_days: 14
      test_env: "ci"
      history_source_workflow_file: ".github/workflows/runner-e2e-allure-smoke.yml"

  publish:
    name: Publish (GitHub Pages)
    needs: [e2e]
    if: ${{ needs.e2e.outputs.has_report == 'true' &&
      contains(fromJson('["main","auto-build-maintenance"]'), github.ref_name) }}
    uses: ./.github/workflows/shared-publish-pages.yml
    secrets: inherit
    with:
      retention_days: 14
      publish_branches_json: '["main","auto-build-maintenance"]'
      source_workflow_file: ".github/workflows/runner-e2e-allure-smoke.yml"
