name: CI - E2E Allure (Nightly)

on:
  schedule:
    - cron: "15 2 * * *" # 02:15 UTC daily
  workflow_dispatch: {}

jobs:
  e2e:
    name: E2E (Allure) - Nightly Regression
    uses: ./.github/workflows/shared-allure-core.yml
    secrets: inherit
    with:
      cucumber_profile: "allure_pretty"
      cucumber_tags: "@regression"
      retention_days: 60
      test_env: "ci"
      test_pack: "Nightly"
      history_source_workflow_file: ".github/workflows/runner-e2e-allure-nightly.yml"

  publish:
    name: Publish (GitHub Pages)
    needs: [e2e]
    if: ${{ needs.e2e.outputs.has_report == 'true' &&
      contains(fromJson('["main","auto-build-maintenance"]'), github.ref_name) }}
    uses: ./.github/workflows/shared-publish-pages.yml
    secrets: inherit
    with:
      retention_days: 60
      publish_branches_json: '["main","auto-build-maintenance"]'
      source_workflow_file: ".github/workflows/runner-e2e-allure-nightly.yml"
      suite: "nightly"
